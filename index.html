<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ระบบจัดการข้อมูล | พานุ 007</title>
<style>
body {
  font-family: "Prompt", sans-serif;
  background: #f0f0f0;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 900px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.header {
  background: #008000;
  color: white;
  padding: 10px 20px;
  border-radius: 6px 6px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.news-item {
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-top: 15px;
  overflow: hidden;
}
.content-box {
  padding: 15px;
  background: #e6ffe6;
}
.news-preview {
  display: flex;
  align-items: center;
}
.news-preview img {
  width: 100px;
  height: 80px;
  object-fit: cover;
  border-radius: 4px;
  margin-left: 10px;
}
.news-edit-area {
  margin-top: 10px;
  background: #f0f0f0;
  padding: 10px;
  border-radius: 4px;
}
.action-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  margin-left: 5px;
  cursor: pointer;
  font-weight: bold;
}
.publish-btn { background: #28a745; color: white; }
.edit-btn { background: #ffc107; color: #333; }
.delete-btn { background: #dc3545; color: white; }
.share-btn { background: #007bff; color: white; }
iframe {
  width: 100%;
  height: 200px;
  border: 0;
  margin-top: 10px;
}
.add-news-section {
  background: #e6ffe6;
  border: 2px solid #008000;
  border-radius: 8px;
  padding: 20px;
  margin-top: 30px;
}
.input-group input, .input-group textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 4px;
  border: 1px solid #ccc;
}
.file-upload {
  display: flex;
  align-items: center;
  gap: 10px;
}
.add-btn {
  background: #008000;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
}
.toggle-tool-btn {
  display: block;
  width: 100%;
  padding: 10px;
  background: #008000;
  color: white;
  border: none;
  border-radius: 4px;
  margin-top: 20px;
  font-weight: bold;
  cursor: pointer;
}
.clear-all-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  margin-top: 10px;
  cursor: pointer;
}
.pagination {
  margin-top: 20px;
  text-align: center;
}
.pagination button {
  padding: 6px 12px;
  margin: 0 3px;
  border: 1px solid #008000;
  background: white;
  color: #008000;
  border-radius: 4px;
  cursor: pointer;
}
.pagination button.active {
  background: #008000;
  color: white;
}
</style>
</head>
<body>

<div class="container">
  <header class="header">
    <h2>ระบบจัดการข้อมูล ของพานุ 007</h2>
    <a href="#" class="view-all-btn" style="color:white;">ดูทั้งหมด →</a>
  </header>

  <div id="news-list"></div>
  <div class="pagination" id="pagination"></div>

  <div class="add-news-section" id="add-news-tool">
    <h3>เพิ่มข่าวใหม่</h3>
    <div class="input-group">
      <input type="text" id="news-title" placeholder="หัวข้อข่าว">
    </div>
    <div class="input-group">
      <input type="url" id="news-link" placeholder="ลิงก์ข่าว (https://...)">
    </div>
    <div class="input-group">
      <input type="text" id="news-map" placeholder="ลิงก์ฝังแผนที่ (https://www.google.com/maps/embed...)">
    </div>
    <div class="file-upload">
      <input type="file" id="news-image" accept="image/*">
      <button class="add-btn" id="add-btn">เพิ่มข่าว</button>
    </div>
    <button class="clear-all-btn" onclick="clearAll()">ลบข้อมูลทั้งหมด</button>
  </div>

  <button id="toggle-tool-btn" class="toggle-tool-btn">ซ่อน/แสดง เครื่องมือเพิ่มข่าว</button>
</div>

<script>
let newsData = JSON.parse(localStorage.getItem("newsData")) || [];
const itemsPerPage = 20;
let currentPage = 1;

function saveNews() {
  localStorage.setItem("newsData", JSON.stringify(newsData));
}

function renderNews(page = 1) {
  currentPage = page;
  const list = document.getElementById("news-list");
  list.innerHTML = "";

  const start = (page - 1) * itemsPerPage;
  const end = start + itemsPerPage;
  const pageItems = newsData.slice(start, end);

  pageItems.forEach((news, index) => {
    const globalIndex = start + index;
    const div = document.createElement("div");
    div.className = "news-item";
    div.innerHTML = `
      <div class="content-box">
        <div class="news-preview">
          <div class="text-placeholder">
            <p><b>${globalIndex + 1}. ${news.title}</b></p>
            <p><a href="${news.link}" target="_blank">${news.link}</a></p>
          </div>
          ${news.image ? `<img src="${news.image}" alt="รูปข่าว">` : ""}
        </div>
        ${news.map ? `<iframe src="${news.map}" loading="lazy"></iframe>` : ""}
        <div class="news-edit-area">
          <button class="action-btn publish-btn" onclick="window.open('${news.link}','_blank')">เปิดลิงก์</button>
          <button class="action-btn share-btn" onclick="shareNews(${globalIndex})">แชร์</button>
          <button class="action-btn edit-btn" onclick="editNews(${globalIndex})">แก้ไข</button>
          <button class="action-btn delete-btn" onclick="deleteNews(${globalIndex})">ลบ</button>
        </div>
      </div>
    `;
    list.appendChild(div);
  });

  renderPagination();
}

function renderPagination() {
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";
  const totalPages = Math.ceil(newsData.length / itemsPerPage);

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.className = i === currentPage ? "active" : "";
    btn.addEventListener("click", () => renderNews(i));
    pagination.appendChild(btn);
  }
}

function addNews() {
  const title = document.getElementById("news-title").value.trim();
  const link = document.getElementById("news-link").value.trim();
  const map = document.getElementById("news-map").value.trim();
  const fileInput = document.getElementById("news-image");
  const file = fileInput.files[0];

  if (!title || !link) return alert("กรอกหัวข้อและลิงก์ข่าวก่อนครับ");

  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      newsData.push({ title, link, map, image: e.target.result });
      saveNews();
      renderNews(Math.ceil(newsData.length / itemsPerPage));
      resetForm();
    };
    reader.readAsDataURL(file);
  } else {
    newsData.push({ title, link, map, image: null });
    saveNews();
    renderNews(Math.ceil(newsData.length / itemsPerPage));
    resetForm();
  }
}

function resetForm() {
  document.getElementById("news-title").value = "";
  document.getElementById("news-link").value = "";
  document.getElementById("news-map").value = "";
  document.getElementById("news-image").value = "";
}

function deleteNews(index) {
  if (confirm("ต้องการลบข่าวนี้หรือไม่?")) {
    newsData.splice(index, 1);
    saveNews();
    const newPage = Math.min(currentPage, Math.ceil(newsData.length / itemsPerPage) || 1);
    renderNews(newPage);
  }
}

function clearAll() {
  if (confirm("ต้องการลบข่าวทั้งหมดหรือไม่?")) {
    localStorage.removeItem("newsData");
    newsData = [];
    renderNews(1);
  }
}

function editNews(index) {
  const newTitle = prompt("แก้ไขหัวข้อข่าว:", newsData[index].title);
  if (newTitle !== null) {
    newsData[index].title = newTitle;
    saveNews();
    renderNews(currentPage);
  }
}

function shareNews(index) {
  const link = newsData[index].link;
  navigator.clipboard.writeText(link);
  alert("คัดลอกลิงก์ข่าวแล้ว:\n" + link);
}

// ซ่อน/แสดงฟอร์มเพิ่มข่าว
document.getElementById("toggle-tool-btn").addEventListener("click", function() {
  const tool = document.getElementById("add-news-tool");
  tool.style.display = tool.style.display === "none" ? "block" : "none";
});

document.getElementById("add-btn").addEventListener("click", addNews);
renderNews();
</script>

</body>
</html>
